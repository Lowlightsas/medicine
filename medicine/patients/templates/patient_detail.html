{%extends "base.html"%}
{%load static%}
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="icon" type="image/x-icon" href="{% static 'img/icon.jpg' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="{%static 'css/bootstrap.min.css' %}">
<!-- style css -->
<link rel="stylesheet" href="{%static 'css/style.css'%}">
<!-- Responsive-->
<link rel="stylesheet" href="{%static 'css/responsive.css'%}">
<!-- fevicon -->
<link rel="icon" href="images/fevicon.png" type="{%static 'image/gif' %}" />
<!-- Scrollbar Custom CSS -->
<link rel="stylesheet" href="{%static 'css/jquery.mCustomScrollbar.min.css'%}">
<!-- Tweaks for older IEs-->
<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<!-- owl stylesheets -->
<link rel="stylesheet" href="{%static 'css/owl.carousel.min.css'%}">
<link rel="stylesheet" href="{%static 'css/owl.theme.default.min.css'%}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<link href="assets/img/favicon.png" rel="icon">
<link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

<!-- Google Fonts -->
<link href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

<!-- Vendor CSS Files -->
<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
<link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
<link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
<link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
<link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
<!-- Template Main CSS File -->
<link href="assets/css/style.css" rel="stylesheet">


<style>


    h2, h3 {
        font-weight: bold;
    }

    .card {
        border: none;
        border-radius: 10px;
    }

    .card-header {
        background-color: #343a40;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        color: white;
    }

    .card-body {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .table th, .table td {
        text-align: left;
        padding: 12px 20px;
    }

    .table th {
        background-color: #f1f1f1;
        color: #343a40;
    }

    .table-hover tbody tr:hover {
        background-color: #f1f1f1;
    }

    .table-bordered {
        border: 1px solid #dee2e6;
    }

    .list-unstyled li {
        margin-bottom: 10px;
        font-size: 14px;
        color: #333;
    }

    .list-unstyled li i {
        color: #4caf50;
        margin-right: 8px;
    }

    .border-radius {
        border-radius: 10px;
    }

    .text-muted {
        color: #6c757d;
    }

    .shadow-sm {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .card-body canvas {
        max-width: 100%;
        height: auto;
    }

    .no-records {
        color: #f44336;
        font-weight: bold;
    }

    .mb-4 {
        margin-bottom: 20px;
    }

    .col-md-6 {
        padding: 15px;
    }
</style>
</head>
<body>

<div class="container mt-5">
<!-- Patient Information and Medical Records Section -->
<div class="row">
    <!-- Patient Information -->
    <div class="col-md-6">
        <div class="card shadow-lg mb-4">
            <div class="card-header bg-dark">
                <h2 class="mb-0 text-white"><i class="fas fa-user text-white"></i> Информация о пациенте</h2>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <h3 class="font-weight-bold">{{ patient.last_name }} {{ patient.first_name }} {{ patient.middle_name }}</h3>
                    <p class="text-muted">&#x2116; ИИН: {{ patient.iin }}</p>
                </div>

                <table class="table table-hover table-bordered mt-4">
                    <thead class="bg-light">
                        <tr>
                            <th class="w-50">Детали</th>
                            <th>Информация</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>Дата рождения</th>
                            <td>{{ patient.date_of_birth }}</td>
                        </tr>
                        <tr>
                            <th>Пол</th>
                            <td>{{ patient.get_gender_display }}</td>
                        </tr>
                        <tr>
                            <th>Контактный номер</th>
                            <td>{{ patient.contact_number }}</td>
                        </tr>
                        <tr>
                            <th>Адрес</th>
                            <td>{{ patient.address }}</td>
                        </tr>
                        <tr>
                            <th>Регион проживания</th>
                            <td>{{ patient.get_region_display }}</td>
                        </tr>
                        <tr>
                            <th>Отделение</th>
                            <td>{{ patient.get_department_display }}</td>
                        </tr>
                        <tr>
                            <th>Дата создания записи</th>
                            <td>{{ patient.created|date:"d.m.Y H:i" }}</td>
                        </tr>
                        <tr>
                            <th>Дата последнего обновления</th>
                            <td>{{ patient.updated|date:"d.m.Y H:i" }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Medical Records -->
    <div class="col-md-6">
        <div class="card shadow-lg mb-4">
            <div class="card-header bg-dark">
                <h3 class="mb-0 text-white"><i class="fas fa-notes-medical text-white"></i> Медицинская информация</h3>
            </div>
            <div class="card-body">
                {% if patient.medical_record_of_patient.exists %}
                    {% for record in patient.medical_record_of_patient.all %}
                    <div class="mb-4 p-3 border rounded shadow-sm">
                        <h5 class="font-weight-bold text-dark">Медицинская карта &#x2116;{{ forloop.counter }}</h5>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-tint"></i> <strong>Тип крови:</strong> {{ record.blood_type|default:"Не указано" }}</li>
                            <li><i class="fas fa-hand-holding-medical"></i> <strong>Резус-фактор:</strong> {{ record.rh_factor|default:"Не указан" }}</li>
                            <li><i class="fas fa-notes-medical"></i> <strong>Хронические болезни:</strong> {{ record.chronic_diseases|default:"Не указаны" }}</li>
                            <li><i class="fas fa-allergies"></i> <strong>Аллергии:</strong> {{ record.allergies|default:"Не указаны" }}</li>
                        </ul>
                        <small class="text-muted d-block">Создано: {{ record.created|date:"d.m.Y H:i" }}</small>
                        <small class="text-muted d-block">Обновлено: {{ record.updated|date:"d.m.Y H:i" }}</small>
                    </div>
                    {% if not forloop.last %}<hr>{% endif %}
                    {% endfor %}
                {% else %}
                    <p class="text-muted no-records">Нет медицинских записей.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
</div>

<!-- Temperature Chart Section -->
<div class="card shadow-lg">
    <div class="card-header bg-dark">
        <h3 class="mb-0 text-white"><i class="fas fa-chart-line text-white"></i> График температуры</h3>
    </div>
    <div class="card-body bg-light">
        <div style="width: 100%; margin: auto;">
            <canvas id="temperatureChart"></canvas>
        </div>
    </div>
</div>

</div>
<!--Таблица лечения пациента-->











<!-- Скрипты -->
<script>
const ctx = document.getElementById('temperatureChart').getContext('2d');

// Данные для графика
const data = {
    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'], // Дни измерений
    datasets: [
        {
            label: 'Morning Temperature (°C)',
            data: [36.5, 36.8, 37.1, 37.5, 37.2],
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            yAxisID: 'y',
        },
        {
            label: 'Evening Temperature (°C)',
            data: [37.0, 37.2, 37.4, 37.8, 37.5],
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            yAxisID: 'y1',
        },
    ],
};

// Конфигурация графика
const config = {
    type: 'line',
    data: data,
    options: {
        responsive: true,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        stacked: false,
        plugins: {
            legend: {
                position: 'top',
            },
        },
        scales: {
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: {
                    display: true,
                    text: 'Temperature (°C)',
                },
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                    display: true,
                    text: 'Temperature (°C)',
                },
                grid: {
                    drawOnChartArea: false,
                },
            },
        },
    },
};

// Рендеринг графика
new Chart(ctx, config);


document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridDay', // Отображение только одного дня
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'timeGridDay,timeGridWeek'
        },
        slotMinTime: '09:00:00', // Начало дня
        slotMaxTime: '13:00:00', // Конец дня
        events: [ // Пример событий
            { title: 'Прием у врача', start: '2024-12-13T10:00:00', end: '2024-12-13T10:15:00', color: 'green' },
            { title: 'Стресс-тест', start: '2024-12-13T10:30:00', end: '2024-12-13T10:45:00', color: 'red' },
            { title: 'Консультация', start: '2024-12-13T11:00:00', end: '2024-12-13T11:15:00', color: 'blue' }
        ],
        allDaySlot: false, // Отключение слота "Весь день"
    });

    calendar.render();
});
</script>
{% endblock %}
